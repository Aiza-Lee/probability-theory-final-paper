\section{路径追踪}

\subsection{简介}
在图形学渲染领域，路径追踪是一种基于蒙特卡洛积分的，模拟场景中光线传播和能量传递、损失，并最终渲染为图像的技术。

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{pictures/路径追踪示意图.png}
	\caption{路径追踪示意图（截图引自 GAMES101 公开课\cite{GAMES101}）}
	\label{fig:games101-raytracing}
\end{figure}

最终需要渲染的是图~\ref{fig:games101-raytracing}中 “image plane” 上的每个像素点。

每个反射点按照一定概率反射一条光线，在场景中随机反射得到一个颜色。
对于每个像素点,从相机发出多条光线，并对每条光线计算的颜色取平均。这就是路径追踪的基本思路。
蒙特卡洛积分的作用在于：每次随机反射的光线，都会对应一定的概率密度，从而可以通过蒙特卡洛积分来估计该光线的最终颜色。

对于各种无偏性的采样，采样效果由估计值的方差决定，方差越小，在有限采样次数下，
得到的光线的结果就会更加接近真实值，从而渲染效果更好。
同时，较大的方差会体现为图片上的“噪点”。

\subsection{BRDF（双向反射分布函数）}
基于辐射度量学，我们在物理世界上抽象出 BRDF，来描述光线的传播\cite{GAMES101}。

BRDF。表示从某个微分的立体角接受的光照会如何映射到发出（反射）光照的方向和强度。
用数学语言描述，对于位于$p$的有向面积微元上，定义双向反射分布函数：
\begin{equation}
	f(\omega_i \rightarrow \omega_r) := \frac{\diff L_r(\omega_r)}{\diff E(\omega_i)}
 = \frac{\diff L_r(\omega_r)}{L_i(\omega_i)\cos\theta_i\diff \omega_i}.
\end{equation}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{pictures/BRDF图示.png}
	\caption{BRDF示意图（截图引自 GAMES101 公开课\cite{GAMES101}）}
	\label{fig:games101-brdf}
\end{figure}
进而可以将某一点$p$在某个立体角方向$\omega_r$上的辐照度$L_r$表示为：
\begin{equation}
	L_r(\omega_r) = L_e(\omega_r) 
		+ \int_{H^+} f(\omega_i \rightarrow \omega_r)
					L_i(\omega_i)\cos \theta_i
					\diff \omega_i.
\end{equation}
（注：公式中省略了表示该反射点的坐标的参数$p$）

等式右侧的复杂积分式可以通过蒙特卡洛积分求解，关键在于如何选择合适的概率分布函数，进而选择合适的采样的立体角方向。

\input{sections/compare_random_and_sphere_figures.tex}